name: Validate Documentation

on:
  push:
    branches: [main, develop]
    paths:
      - '**/*.md'
      - '**/*.py'
      - '**/*.js'
  pull_request:
    branches: [main, develop]
    paths:
      - '**/*.md'
      - '**/*.py'
      - '**/*.js'

jobs:
  markdown-lint:
    name: Lint Markdown files
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Lint Markdown files
        uses: articulate/actions-markdownlint@v1
        with:
          config: .markdownlint.json
          files: '**/*.md'
          ignore: 'node_modules'
          version: '0.35.0'
        continue-on-error: true

  check-file-structure:
    name: Validate file structure
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Check required files exist
        run: |
          # Check required files in root
          required_files=(
            "README.md"
            "CONTRIBUTING.md"
            "CHANGELOG.md"
            "FAQ.md"
            "LICENSE"
          )

          missing_files=()
          for file in "${required_files[@]}"; do
            if [ ! -f "$file" ]; then
              missing_files+=("$file")
            fi
          done

          if [ ${#missing_files[@]} -ne 0 ]; then
            echo "❌ Missing required files:"
            printf '%s\n' "${missing_files[@]}"
            exit 1
          fi

          echo "✅ All required root files present"

      - name: Check examples have README
        run: |
          # Check each example has a README
          missing_readmes=()
          for dir in examples/*/; do
            if [ ! -f "${dir}README.md" ]; then
              missing_readmes+=("${dir}README.md")
            fi
          done

          if [ ${#missing_readmes[@]} -ne 0 ]; then
            echo "⚠️  Missing README files in examples:"
            printf '%s\n' "${missing_readmes[@]}"
            exit 1
          fi

          echo "✅ All examples have README files"

  validate-python:
    name: Validate Python code
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Check Python syntax
        run: |
          # Find all Python files and check syntax
          find . -name "*.py" -not -path "./venv/*" -not -path "./node_modules/*" | while read file; do
            echo "Checking syntax: $file"
            python -m py_compile "$file"
          done

  validate-javascript:
    name: Validate JavaScript code
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: Check JavaScript syntax
        run: |
          # Find all JavaScript files and check syntax
          find . -name "*.js" -not -path "./node_modules/*" | while read file; do
            echo "Checking syntax: $file"
            node --check "$file"
          done

  report-status:
    name: Report validation status
    runs-on: ubuntu-latest
    needs: [markdown-lint, check-file-structure, validate-python, validate-javascript]
    if: always()

    steps:
      - name: Check all jobs passed
        run: |
          if [[ "${{ needs.markdown-lint.result }}" == "success" && \
                "${{ needs.check-file-structure.result }}" == "success" && \
                "${{ needs.validate-python.result }}" == "success" && \
                "${{ needs.validate-javascript.result }}" == "success" ]]; then
            echo "✅ All validation checks passed!"
            exit 0
          else
            echo "❌ Some validation checks failed"
            exit 1
          fi
